<!--
 * FCKeditor - The text editor for internet
 * Copyright (C) 2003 Frederico Caldeira Knabben
 *
 * Licensed under the terms of the GNU Lesser General Public License
 * (http://www.opensource.org/licenses/lgpl-license.php)
 *
 * For further information go to http://www.fredck.com/FCKeditor/ 
 * or contact fckeditor@fredck.com.
 *
 * fck_image.html: Image dialog box.
 *
 * Authors:
 *   Frederico Caldeira Knabben (fckeditor@fredck.com)
-->
<HTML>
	<HEAD>
		<TITLE>Вставка изображения</TITLE>
		<META name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">
		<LINK rel="stylesheet" type="text/css" href="../css/fck_dialog.css">
		<SCRIPT language="JavaScript">
// Get browsing configuration
var bCanBrowse = dialogArguments.config.ImageBrowser ;
var sBrowseURL = dialogArguments.config.ImageBrowserURL ;
var iBrowseWindowWidth  = dialogArguments.config.ImageBrowserWindowWidth ;
var iBrowseWindowHeight = dialogArguments.config.ImageBrowserWindowHeight ;

// Get upload configuration
var bCanUpload = dialogArguments.config.ImageUpload && dialogArguments.BrowserInfo.IsIE55OrMore ;
var sUploadURL = dialogArguments.config.ImageUploadURL ;
var iUploadWindowWidth  = dialogArguments.config.ImageUploadWindowWidth ;
var iUploadWindowHeight = dialogArguments.config.ImageUploadWindowHeight ;
var sUploadAllowedExtensions = dialogArguments.config.ImageUploadAllowedExtensions ;

// Gets the document DOM
var oDOM = dialogArguments.objContent.DOM ;

// Gets the image if there is one selected.
var image ;
var sel = oDOM.selection.createRange();
if (oDOM.selection.type != 'Text') 
{
	if (sel.length == 1) 
	{
		if (sel.item(0).tagName == "IMG") image = sel.item(0);
	}
}

// Gets a copy of the image (for image size purposes
var imageOriginal
if (image != null)
{
	imageOriginal = new Image() ;
	imageOriginal.src = image.src ;
}
else 
	imageOriginal = null ;

// Set the dialog title.
if (image) 
	document.write("<TITLE>Редактирование изображения</TITLE>") ;
else 
	document.write("<TITLE>Вставка изображения</TITLE>") ;
	
// Get the IMG tag.
function getImageHtml()
{
	return '<IMG' 
				+ attr("src", txtURL.value)
				+ attr("alt", txtAlt.value) 
				+ attr("align", cmbAlign[cmbAlign.selectedIndex].value)
				+ ((txtWidth.value)  ? attr("width" , txtWidth.value)  : "")
				+ ((txtHeight.value) ? attr("height", txtHeight.value) : "")
				+ ((txtVSpace.value) ? attr("vspace", txtVSpace.value) : "")
				+ ((txtHSpace.value) ? attr("hspace", txtHSpace.value) : "")
				+ ((txtBorder.value) ? attr("border", txtBorder.value) : attr("border",0))
				+ '/>' ;
}

// Returns a formatted image attribute. Used by getImageHtml(). 
function attr(name, value) 
{
	if (!value || value == "") return "" ;
	return ' ' + name + '="' + value + '"' ;
}

// Update any image (the selected or preview one)
function updateImage(imgTarget)
{
	imgTarget.src = txtURL.value ;
//	setAttribute(imgTarget, "src"   , txtURL.value) ;		
	setAttribute(imgTarget, "alt"   , txtAlt.value) ;		
	setAttribute(imgTarget, "width" , txtWidth.value) ;		
	setAttribute(imgTarget, "height", txtHeight.value) ;		
	setAttribute(imgTarget, "vspace", txtVSpace.value) ;		
	setAttribute(imgTarget, "hspace", txtHSpace.value) ;		
	setAttribute(imgTarget, "border", txtBorder.value) ;		
	setAttribute(imgTarget, "align" , cmbAlign.options[ cmbAlign.selectedIndex ].value) ;
}

function setAttribute(element, attribute, value)
{
	if (value == null || value == "")
		element.removeAttribute(attribute, 0) ;			// 0 = case insensitive
	else 
		element.setAttribute(attribute, value, 0) ;		// 0 = overwrite
}

// Fired when any field change to update the preview image.
function updatePreview()
{
	updateImage(imgPreview) ;
}

// Fired when the user press the OK button
function ok()
{
	window.returnValue = getImageHtml() ;
	window.close() ;
}

// Fired when the user press the CANCEL button.
function cancel() 
{
	window.returnValue = null ;
	window.close() ;
}

// Fired when the user load the window. It sets the fields with the
// actual values if an image is selected in the editor.
function setDefaults()
{
	if (image == null) return ;

	if (image.getAttribute("src",2)    != null) txtURL.value    = image.getAttribute("src",2) ;
	if (image.getAttribute("alt",2)    != null) txtAlt.value    = image.getAttribute("alt",2) ;
	if (image.getAttribute("width",2)  != null) txtWidth.value  = image.getAttribute("width",2) ;
	if (image.getAttribute("height",2) != null) txtHeight.value = image.getAttribute("height",2) ;
	if (image.getAttribute("vspace",2) != null) txtVSpace.value = image.getAttribute("vspace",2) ;
	if (image.getAttribute("hspace",2) != null) txtHSpace.value = image.getAttribute("hspace",2) ;
	if (image.getAttribute("border",2) != null) txtBorder.value = image.getAttribute("border",2) ;

	if (image.getAttribute("align") != null) 
	{
		for (var i = 0 ; i < cmbAlign.options.length ; i++) 
		{
			if (cmbAlign.options[i].value == image.getAttribute("align")) 
			{
				cmbAlign.options[i].selected = true ;
				break ;
			}
		}
	}

	updatePreview() ;
}

// Fired when the width or height input texts change
function sizeChanged(axe) 
{
	// Verifies if the aspect ration has to be mantained
	if (imageOriginal && chkLockRatio.checked)
	{
		if ((axe) == "Width")
		{
			if (txtWidth.value != "") 
			{
				if (! isNaN(txtWidth.value))
					txtHeight.value = Math.round( imageOriginal.height * ( txtWidth.value  / imageOriginal.width ) ) ;
			}
			else
				txtHeight.value = "" ;
		}
		else
			if (txtHeight.value != "")
			{
				if (! isNaN(txtHeight.value))
					txtWidth.value  = Math.round( imageOriginal.width  * ( txtHeight.value / imageOriginal.height ) ) ;
			}
			else
				txtWidth.value = "" ;
	}
	
	updatePreview() ;
}

// Fired when the Lock Ratio checkbox is clicked
function onLockRationClick()
{
	sizeChanged("Width") ;
}

// Fired when the Reset Size button is clicked
function resetSize()
{
	if (! imageOriginal) return ;

	txtWidth.value  = imageOriginal.width ;
	txtHeight.value = imageOriginal.height ;
	updatePreview() ;
}

// Fired when the user click in the "Sent it to the Server" button.
function uploadFile()
{
	var sFile = frmUpload.FCKeditor_File.value ;

	if (sFile == "")
	{
		alert("Пожалуйста, выберите файл с изображением.") ;
		return ;
	}
	
	var sExt = sFile.match( /\.[^\.]*$/ ) ;
	sExt = sExt ? sExt[0].toLowerCase() : "." ;

	if ( sUploadAllowedExtensions.indexOf( sExt ) < 0 )
	{
		alert("Неизвестный формат файла. Поддерживаются следующие форматы файлов:\n\n" + sUploadAllowedExtensions + "\n\nОперация отменена.") ; 
		return ;
	}

	var oWindow = openNewWindow("", "UploadWindow", iUploadWindowWidth, iUploadWindowHeight) ;
	frmUpload.submit() ;
	oWindow.setImage = setImage ;
}

function browserServer()
{
	var oWindow = openNewWindow(sBrowseURL, "BrowseWindow", iBrowseWindowWidth, iBrowseWindowHeight) ;
	oWindow.setImage = setImage ;
}

function openNewWindow(sURL, sName, iWidth, iHeight, bResizable, bScrollbars)
{
	var iTop  = (screen.height - iHeight) / 2 ;
	var iLeft = (screen.width  - iWidth) / 2 ;
	
	var sOptions = "toolbar=no" ;
	sOptions += ",width=" + iWidth ; 
	sOptions += ",height=" + iHeight ;
	sOptions += ",resizable="  + (bResizable  ? "yes" : "no") ;
	sOptions += ",scrollbars=" + (bScrollbars ? "yes" : "no") ;
	sOptions += ",left=" + iLeft ;
	sOptions += ",top=" + iTop ;
	
	var oWindow = window.open(sURL, sName, sOptions)
	oWindow.focus();
	
	return oWindow ;
}

function setImage(sImageURL)
{
	if (image != null)
	{
		image = new Image() ;
		image.src = sImageURL ;
	}
	
	imageOriginal = new Image() ;
	imageOriginal.onload = resetSize ;
	imageOriginal.src = sImageURL ;

	txtURL.value = sImageURL ;
	updatePreview() ;
}
		</SCRIPT>
	</HEAD>
	<BODY bottommargin="5" leftmargin="5" topmargin="5" rightmargin="5" onload="setDefaults()">
		<TABLE cellspacing="1" cellpadding="1" border="0" width="100%" class="dlg" height="100%">
			<TR>
				<TD>
					<TABLE cellspacing="0" cellpadding="0" width="100%" border="0">
						<TR>
							<TD valign="top">URL-Адрес:<BR>
								<INPUT style="WIDTH: 100%" type="text" id="txtURL" onblur="updatePreview();">
								<TABLE cellspacing="0" cellpadding="0" width="100%" border="0" style="DISPLAY: none" id="tableUpload">
									<TR>
										<FORM id="frmUpload" enctype="multipart/form-data" method="post" target="UploadWindow">
											<TD>Загрузить с моего компьютера:<BR>
												<INPUT style="WIDTH: 100%" type="file" name="FCKeditor_File" id="FCKeditor_File">
											</TD>
									</TR>
									<TR>
										<TD align="right">
											<INPUT id="btnUpload" type="button" value="Сохранить на сервере" onclick="uploadFile();">
										</TD>
										</FORM>
									</TR>
								</TABLE>
							</TD>
							<TD width="10">&nbsp;&nbsp;&nbsp;
							</TD>
							<TD valign="top" width="100">
								<INPUT type="button" style="WIDTH: 100%" value="Ok" onclick="ok();">
								<BR>
								<INPUT type="button" style="WIDTH: 100%" value="Cancel" onclick="cancel();">
								<BR>
								<INPUT type="button" style="DISPLAY: none; WIDTH: 100%" value="Обзор сервера" onclick="browserServer();" id="btnBrowse">
							</TD>
						</TR>
					</TABLE>
				</TD>
			</TR>
			<TR>
				<TD>Текст для замены:<BR>
					<INPUT style="WIDTH: 100%" type="text" id="txtAlt" onkeyup="updatePreview();">
				</TD>
			</TR>
			<TR height="100%">
				<TD>
					<TABLE cellspacing="0" cellpadding="0" width="100%" border="0" height="100%">
						<TR>
							<TD width="100" valign="top">
								<br>
								<TABLE cellspacing="0" cellpadding="0" border="0">
									<TR>
										<TD>Ширина&nbsp;</TD>
										<TD>
											<INPUT type="text" size="3" id="txtWidth" onkeyup="sizeChanged('Width');"></TD>
									</TR>
									<TR>
										<TD>Высота&nbsp;</TD>
										<TD>
											<INPUT type="text" size="3" id="txtHeight" onkeyup="sizeChanged('Height');"></TD>
									</TR>
								</TABLE>
								<INPUT type="checkbox" class="CheckBox" checked id="chkLockRatio" onclick="onLockRationClick();">
								Пропорции
								<BR>
								<INPUT type="button" value="Исходный размер" onclick="resetSize();">
								<BR>
								<BR>
								<TABLE cellspacing="0" cellpadding="0" border="0">
									<TR>
										<TD colspan=2><nobr>Граница&nbsp;</nobr></TD>
										<TD colspan=2>
											<INPUT type="text" size="2" value="0" id="txtBorder" onkeyup="updatePreview();"></TD>
									</TR>
									<TR>
										<TD><nobr>Отступ по&nbsp;<br>горизонтали&nbsp;</nobr></TD>
										<TD>
											<INPUT type="text" size="2" id="txtHSpace" onkeyup="updatePreview();"></TD>
									</TR>
									<TR>
										<TD><nobr>Отступ по&nbsp;<br>вертикали&nbsp;</nobr></TD>
										<TD>
											<INPUT type="text" size="2" id="txtVSpace" onkeyup="updatePreview();"></TD>
									</TR>
									<TR>
										<TD colspan=2>Положение</TD>
										<TD colspan=2><SELECT id="cmbAlign" onchange="updatePreview();">
												<OPTION value="" selected></OPTION>
												<OPTION value="left">Left</OPTION>
												<OPTION value="absBottom">Abs Bottom</OPTION>
												<OPTION value="absMiddle">Abs Middle</OPTION>
												<OPTION value="baseline">Baseline</OPTION>
												<OPTION value="bottom">Bottom</OPTION>
												<OPTION value="middle">Middle</OPTION>
												<OPTION value="right">Right</OPTION>
												<OPTION value="textTop">Text Top</OPTION>
												<OPTION value="top">Top</OPTION>
											</SELECT></TD>
									</TR>
								</TABLE>
							</TD>
							<TD>&nbsp;&nbsp;&nbsp;</TD>
							<TD width="100%">
								<table cellpadding="0" cellspacing="0" height="100%" width=100%>
									<tr>
										<td>Предпросмотр</td>
									</tr>
									<tr height="100%">
										<td width=100%>
											<DIV class="ImagePreviewArea" width=100% height=100%>
												<IMG id="imgPreview" src="/admin/img/pix.gif" border=0 width=100% height=100%>
											</DIV>
										</td>
									</tr>
								</table>
							</TD>
						</TR>
					</TABLE>
				</TD>
			</TR>
		</TABLE>
		<SCRIPT language="javascript">
<!--
	if (bCanUpload)
	{
		tableUpload.style.display = "block" ;
		frmUpload.action = sUploadURL ;
	}
	
	if (bCanBrowse)
		btnBrowse.style.display = "block" ;
//-->
</SCRIPT>
	</BODY>
</HTML>
