#!/usr/bin/perl
use strict qw(subs vars);

use CGI 'param';

our $fname = '../error.log';
our $plen = 3072;

sub main
{
	print "Content-type: text/html; charset=windows-1251\n\n";
	
	my $act = param('act');
	
	if($act eq 'clear')
	{
		clear_log();
		print '<p align="center"><a href="?">OK</a></p>';
		
		return;
	}
	
	my $page = param('page');
	
	print '<p align="center"><a href="?act=clear">Очистить</a></p>';
	
	print '<p align="center">';
	print '<a href="?page=',$page-1,'">&larr; Назад</a>&nbsp;&nbsp;&nbsp;' if $page;
	print '<a href="?page=',$page+1,'">Далее &rarr;</a>';
	print '</p>';
	
	print '<pre>';
	print_log($page);
	print '</pre>';
}

sub clear_log
{
	my $fh;
	#open($fh,'>',$fname);
	
	truncate(STDERR,0);
	
	#close($fh);
}

sub print_log
{
	my $p = shift;
	
	my $fh;
	open($fh,'<',$fname);
	
	seek($fh,-1*$plen*($p+1),2);
	my $buff;
	read($fh,$buff,$plen);
	
	#$buff =~ s/\n/<br>\n/g;
	
	print $buff;
	#print join('<br>',<$fh>);
	
	close($fh);
}


main();